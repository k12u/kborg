# 比較評価レポート（再実施）

対象:
- A案（本セッション）: `TECHNICAL_DESIGN.md`（v0.2）
- B案（提供版）: `kborg 技術設計書 v1.0`（ユーザー提示テキスト）

---

## 1. 総合評価

結論として、**B案（v1.0）の方が実装着手性が高い**。

主な理由:

1. API/DDL/制約値（timeout, 文字数上限, rate limit, model指定）が具体化されている
2. 未決事項（personal/org/novelty/tag/clean text上限）に対して設計判断が明示されている
3. ディレクトリ構成・実装フェーズのToDo粒度が、開発タスクへ直結する

一方、A案は上位方針・境界定義・運用観点（ADR、非機能、エラー分類）は良いが、実装時に追加判断が必要な項目が残る。

---

## 2. 観点別比較

## 2.1 目的・思想整合

- A案: GOAL/DESIGNの思想（認知負債最小化、保存と露出制御の分離）を明瞭に反映
- B案: 同思想を維持しつつ、システム定義を短く明確化

評価: **同等（Aは説明力、Bは簡潔性）**

## 2.2 アーキテクチャ具体性

- A案: Ingestion/Portal責務は明確
- B案: 入力チャネル（Webhook/Extension/CLI）とAPI面（Ingest/Portal）まで明記

評価: **B優位**

## 2.3 データ設計（D1/R2/Vectorize）

- A案: itemsスキーマ・索引・R2 key・Vectorize最小メタを定義
- B案: SQL DDLを直接提示、default/NOT NULL制約、Vector次元/metric、clean text上限（30KB）まで確定

評価: **B優位（実装直結）**

## 2.4 API契約

- A案: endpoint列挙はあるが、request/response例は限定的
- B案: `POST /api/ingest` の重複時200を含む返却仕様、`/api/search` の手順、`PATCH` payloadまで具体

評価: **B優位**

## 2.5 未決事項への対処

- A案: 未決事項を列挙し、ADRで後決め
- B案: 各未決事項に暫定採用案（profile/org_themes/novelty式/タグ語彙）を与える

評価: **B優位（意思決定コストが低い）**

## 2.6 運用・セキュリティ

- A案: 冪等性・可監査性・移行性は明記
- B案: 認証、CORS、Rate Limiting、LLMコスト見積りまで具体

評価: **B優位**

## 2.7 実装計画

- A案: Phase 1〜3の方向性
- B案: Phase 1〜4に加え、プロジェクト構成と実装チェックリストを提示

評価: **B優位**

---

## 3. 差分サマリ（重要項目）

### B案にあり、A案に不足していた具体化

- D1 DDL（型・DEFAULT・制約・インデックスSQL）
- Vectorize index仕様（768次元 / cosine / モデル準拠）
- clean text上限を30KBで確定
- LLMモデル名、温度、max tokens、単一プロンプト方針
- API認証、CORS、Rate limit
- 実装ディレクトリ構成例

### A案の強み（維持価値）

- 非機能要件の整理（移行性・監査性）
- エラー処理の段階整理（DLQ/再実行）
- 受け入れ基準の明確さ

---

## 4. 推奨統合方針（採用案）

最終設計は **B案をベース** にしつつ、A案の以下を取り込むのが最適。

1. **受け入れ基準**（A案 11章）をB案に移植
2. **エラー処理方針**（A案 8章）をB案のIngest処理に統合
3. **ADR運用**（A案 9.2）をB案の「設計判断」更新手順として採用
4. **base_score固定化原則**（保存時確定）を明示して再計算条件を限定

これにより、
- 実装速度（B案）
- 運用安定性・変更管理（A案）

を両立できる。

---

## 5. 最終判定

- ドキュメント単体の完成度: **B案 > A案**
- 実装着手の容易さ: **B案 > A案**
- 運用設計の堅牢性: **A案 >= B案**（Aの運用記述を統合すればBが上回る）

**推奨:** 以後の実装はB案（v1.0）を正本にし、A案の運用面の強みを追補して `TECHNICAL_DESIGN.md` をv1.1へ更新する。
